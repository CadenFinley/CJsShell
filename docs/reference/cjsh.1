.TH CJSH 1 "October 2025" "CJ's Shell" "User Commands"
.SH NAME
cjsh \- POSIX shell scripting meets modern shell features.
.SH SYNOPSIS
.B cjsh
.RI [ options ] " [script_file [args...]]"
.br
.B cjsh
.B -c
.I command_string
.RI [ args... ]
.SH DESCRIPTION
.B cjsh
is a single-binary shell that combines a POSIX-oriented scripting engine with
an interactive environment powered by a heavily modified instance of the
isocline line editor. The runtime bundles its parser, interpreter, job control,
theme engine, completion framework, syntax highlighter, and hook system so that
no external plugins are required. The shell targets roughly 95% POSIX
compatibility while exposing opt-in enhancements for interactive use.
.PP
When launched without a script, cjsh runs interactively, presenting themed
prompts, tab completions, history search, syntax highlighting, and other
productivity features. When provided a script, it executes in non-interactive
mode while preserving POSIX semantics. The 
.BR -c 
form accepts an inline command string.
.SH STARTUP MODES
.TP
.B Login shells
Activated when cjsh is invoked with 
.BR -l "," 
.BR --login "," or
with a leading dash in 
.IR argv[0] .
Login shells source system profile files before interactive setup and may apply
persisted startup flags.
.TP
.B Interactive shells
The default when standard input is a TTY or when forced with
.BR -i 
(\fB--interactive\fR). Interactive shells initialize the editor, theme,
completion, highlighting, and prompt subsystems and then drop into the main
read-eval-print loop.
.TP
.B Non-interactive shells
When cjsh is given a script file, reads from standard input, or runs with
.BR -c ,
it executes commands non-interactively. Most interactive facilities, including
the line editor and theme system, remain disabled unless explicitly forced on.
.SH STARTUP PROCEDURE
On startup cjsh performs the following steps:
.IP "1." 4
Initialize runtime directories under 
.I ~/.config/cjsh
and 
.I ~/.cache/cjsh
for configuration, history, and generated completions.
.IP "2." 4
Set baseline environment variables (\fBPATH\fR, \fBMANPATH\fR on Linux,
\fBSHLVL\fR, \fBUSER\fR, \fBCJSH_VERSION\fR, and others) via
.BR shell_env .
.IP "3." 4
Parse command-line flags and persist them for reference (see
.BR OPTIONS ).
.IP "4." 4
For login shells, source 
.I ~/.profile
(if present) followed by 
.I ~/.cjprofile
or 
.I ~/.config/cjsh/.cjprofile
unless 
.B --secure
or 
.B --no-source
was requested. Any 
.B cjshopt login-startup-arg
entries inside the profile are collected and applied before interactive
initialization.
.IP "5." 4
If interactive mode is selected, initialize the editor, colors, syntax
highlighter, and theme system, then source 
.I ~/.cjshrc
or 
.I ~/.config/cjsh/.cjshrc
unless disabled or running in secure mode.
.IP "6." 4
Display the title line and optional startup timing metrics when enabled,
process first-boot messaging, and finally enter the main event loop.
On exit from a login session cjsh sources 
.I ~/.cjsh_logout
(if present and not suppressed by secure mode).
.SH OPTIONS
Unless otherwise noted, long options are equivalent to their short forms.
.SS General execution
.TP
.BR -h ", " --help
Display the bundled usage text and exit.
.TP
.BR -v ", " --version
Print detailed version information and exit.
.TP
.BR -l ", " --login
Force login-shell initialization regardless of invocation name.
.TP
.BR -i ", " --interactive
Force interactive mode even when standard input is not a TTY.
.TP
.BR -c ", " --command = COMMAND
Execute 
.I COMMAND
as a single string and exit. Any remaining arguments become positional
parameters.
.SS Feature control
.TP
.BR -m ", " --minimal
Disable cjsh-specific interactive layers (themes, colors, completions, syntax
highlighting, smart directory navigation, configuration sourcing, startup
metrics, and history expansion) while retaining the POSIX core.
.TP
.BR -T ", " --no-themes
Disable the theme engine and prompt DSL.
.TP
.BR -C ", " --no-colors
Disable color output globally.
.TP
.BR -N ", " --no-source
Skip sourcing 
.I ~/.cjshrc
and its alternate path.
.TP
.BR -O ", " --no-completions
Disable the completion engine and its adaptive ranking.
.TP
.BR -S ", " --no-syntax-highlighting
Turn off real-time syntax highlighting provided by the editor.
.TP
.BR -M ", " --no-smart-cd
Use the basic POSIX 
.B cd
behavior without fuzzy directory navigation or bookmarking.
.TP
.BR -H ", " --no-history-expansion
Disable history expansion tokens such as 
.B !!
within interactive sessions.
.SS Display controls
.TP
.BR -L ", " --no-titleline
Suppress the startup title banner that appears in interactive mode.
.TP
.BR -P ", " --no-prompt
Start with a minimal 
.B #
prompt instead of the themed prompt set.
.TP
.BR -U ", " --show-startup-time
Print how long cjsh spent initializing before presenting the prompt.
.SS Security and testing
.TP
.BR -s ", " --secure
Secure mode: skip all user configuration files and run with conservative
defaults suitable for untrusted environments.
.TP
.BR -X ", " --startup-test
Enable internal startup test instrumentation. Intended for automated diagnostics
and continuous integration.
.SH ARCHITECTURE OVERVIEW
cjsh is composed of several core subsystems:
.TP
.B Parser and interpreter
Implements a POSIX-style grammar with common bash extensions, performing
expansion, redirection, and job control internally.
.TP
.B Interactive line editor
A customized isocline fork powers multiline input, incremental history search,
fuzzy completions, inline hints, and syntax highlighting.
.TP
.B Theme and prompt engine
A declarative DSL renders prompts, title lines, and right-aligned segments while
caching expensive computations for performance.
.TP
.B Completion framework
Aggregates commands, files, variables, users, and hostnames with fuzzy matching
and adaptive ranking. Cached metadata lives under 
.I ~/.cache/cjsh/generated_completions
and can be regenerated offline.
.TP
.B Hook system
Lifecycle hooks (\fBprecmd\fR, \fBpreexec\fR, \fBchpwd\fR) allow custom
behavior around prompt display, command execution, and directory changes.
.TP
.B Job control and signals
Foreground/background management, signal propagation, and trap handling are
implemented in-process and integrate with the shell's event loop.
.SH INTERACTIVE FEATURES
Interactive sessions enable:
.IP \(bu 2
Syntax-highlighted, multiline editing with configurable key bindings.
.IP \(bu 2
Fuzzy, context-aware completions with spell correction and inline previews.
.IP \(bu 2
Smart directory navigation with bookmarks and blacklist support.
.IP \(bu 2
Persistent command history stored at 
.I ~/.cache/cjsh/history.txt
with reverse search and history expansion.
.IP \(bu 2
Theme-driven prompts with rich status segments, right-aligned indicators, and
support for 24-bit color.
.IP \(bu 2
Inline hints, typeahead buffering, and optional visible whitespace markers.
.PP
Most features can be toggled at runtime or persisted by editing
.I ~/.cjshrc
or by storing startup flags via 
.B cjshopt login-startup-arg
inside 
.I ~/.cjprofile
.
.SH FILES
.TP
.I ~/.cjprofile
Per-user login configuration. Parsed before interactive setup; ideal for
persisting startup flags and environment tweaks.
.TP
.I ~/.cjshrc
Primary interactive configuration. Source this file to set themes, hooks, and
runtime options. The alternate path 
.I ~/.config/cjsh/.cjshrc
is also honored.
.TP
.I ~/.cjsh_logout
Optional logout script sourced when a login shell exits.
.TP
.I ~/.cache/cjsh/history.txt
Persistent command history file.
.TP
.I ~/.cache/cjsh/generated_completions
Cache directory for precomputed completion metadata.
.SH ENVIRONMENT
.TP
.B CJSH_VERSION
Current cjsh version string, exported during initialization.
.TP
.B SHLVL
Incremented when cjsh starts to reflect shell nesting depth.
.TP
.B PATH
Set to a reasonable default when missing and augmented with common user and
system locations when possible.
.TP
.B MANPATH
On Linux, populated with standard manual directories if previously unset.
.TP
.B PAGER
Defaults to 
.B less
when unset so that built-in help renders predictably.
.SH EXIT STATUS
When executing scripts or commands, cjsh returns the exit status of the last
command that ran. If a startup error occurs, a non-zero diagnostic code is
returned instead. The 
.B EXIT_CODE
environment variable can be set by scripts to override the final exit status.
.SH SEE ALSO
Documentation hub: https://cadenfinley.github.io/CJsShell/
.br
Project repository: https://github.com/CadenFinley/CJsShell
.br
Inside cjsh: run 
.B help
for built-in command details and 
.B cjshopt --help
for configuration toggles.
