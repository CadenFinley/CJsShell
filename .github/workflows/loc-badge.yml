name: Update Lines of Code Badge

on:
  schedule:
    - cron: "0 0 * * *"  # Run daily at midnight
  push:
    branches: [ main ]
  workflow_dispatch:  # Allow manual triggering

jobs:
  update-loc-badge:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
        with:
          fetch-depth: 0

      - name: Count lines of code
        id: loc
        run: |
          # Install cloc tool
          sudo apt-get install -y cloc
          
          # Count lines excluding .git, .github, and other non-code directories
          TOTAL_LINES=$(cloc . --exclude-dir=.git,.github,build --json | jq -r '.SUM.code')
          
          # Set output for later steps
          echo "total=$TOTAL_LINES" >> $GITHUB_OUTPUT
          
          # Display for debugging
          echo "Total lines of code: $TOTAL_LINES"

      - name: Update LOC badge
        run: |
          # Get the current lines of code count
          TOTAL_LINES="${{ steps.loc.outputs.total }}"
          
          # Create or update the badge SVG
          mkdir -p .github/badges
          cat > .github/badges/loc.svg << EOF
          <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="138" height="20" role="img" aria-label="lines of code: $TOTAL_LINES">
            <title>lines of code: $TOTAL_LINES</title>
            <linearGradient id="s" x2="0" y2="100%">
              <stop offset="0" stop-color="#bbb" stop-opacity=".1"/>
              <stop offset="1" stop-opacity=".1"/>
            </linearGradient>
            <clipPath id="r">
              <rect width="138" height="20" rx="3" fill="#fff"/>
            </clipPath>
            <g clip-path="url(#r)">
              <rect width="89" height="20" fill="#555"/>
              <rect x="89" width="49" height="20" fill="#4c1"/>
              <rect width="138" height="20" fill="url(#s)"/>
            </g>
            <g fill="#fff" text-anchor="middle" font-family="Verdana,Geneva,DejaVu Sans,sans-serif" text-rendering="geometricPrecision" font-size="110">
              <text aria-hidden="true" x="455" y="150" fill="#010101" fill-opacity=".3" transform="scale(.1)" textLength="790">lines of code</text>
              <text x="455" y="140" transform="scale(.1)" fill="#fff" textLength="790">lines of code</text>
              <text aria-hidden="true" x="1125" y="150" fill="#010101" fill-opacity=".3" transform="scale(.1)" textLength="390">$TOTAL_LINES</text>
              <text x="1125" y="140" transform="scale(.1)" fill="#fff" textLength="390">$TOTAL_LINES</text>
            </g>
          </svg>
          EOF

      - name: Commit and push badge
        run: |
          git config --global user.name 'GitHub Actions'
          git config --global user.email 'actions@github.com'
          git add .github/badges/loc.svg
          git commit -m "Update lines of code badge" || echo "No changes to commit"
          git push
```
